
#import <Foundation/Foundation.h>
typedef struct {
    Byte looking;
    Byte *imageBubble;
    unsigned int beginLab;
    Byte remoteTing;
	int eigenvalueOfAMatrix;
	int endBar;
	int visualImage;
} EndBlueData;

NSString *StringFromEndBlueData(EndBlueData *data);


//: value
EndBlueData userTingValue = (EndBlueData){49, (Byte []){71, 80, 93, 68, 84, 179}, 5, 181, 140, 48, 204};

//: password
EndBlueData kTeamValue = (EndBlueData){136, (Byte []){248, 233, 251, 251, 255, 231, 250, 236, 205}, 8, 255, 113, 60, 75};

//: openPacketId
EndBlueData app_globalTitle = (EndBlueData){113, (Byte []){30, 1, 20, 31, 33, 16, 18, 26, 20, 5, 56, 21, 238}, 12, 183, 38, 1, 152};

//: messageAbstract
EndBlueData mainMessageRemoteTextData = (EndBlueData){113, (Byte []){28, 20, 2, 2, 16, 22, 20, 48, 19, 2, 5, 3, 16, 18, 5, 141}, 15, 222, 101, 25, 130};

//: compressed
EndBlueData userEnableCustomTableId = (EndBlueData){59, (Byte []){88, 84, 86, 75, 73, 94, 72, 72, 94, 95, 159}, 10, 177, 5, 95, 123};

//: isGetDone
EndBlueData userSingleContent = (EndBlueData){168, (Byte []){193, 219, 239, 205, 220, 236, 199, 198, 205, 150}, 9, 221, 160, 117, 23};

//: sessionId
EndBlueData showSingleId = (EndBlueData){68, (Byte []){55, 33, 55, 55, 45, 43, 42, 13, 32, 221}, 9, 210, 71, 244, 156};

//: redPacketSendID
EndBlueData dreamContainerFormat = (EndBlueData){216, (Byte []){170, 189, 188, 136, 185, 187, 179, 189, 172, 139, 189, 182, 188, 145, 156, 166}, 15, 250, 86, 1, 81};

//: flag
EndBlueData mRangeValueIdent = (EndBlueData){184, (Byte []){222, 212, 217, 223, 47}, 4, 246, 71, 14, 247};

//: content
EndBlueData m_stateStr = (EndBlueData){249, (Byte []){154, 150, 151, 141, 156, 151, 141, 131}, 7, 239, 77, 159, 196};

//: url
EndBlueData k_enableBackMsg = (EndBlueData){194, (Byte []){183, 176, 174, 87}, 3, 194, 126, 67, 13};

//: redPacketId
EndBlueData dreamSingleName = (EndBlueData){233, (Byte []){155, 140, 141, 185, 136, 138, 130, 140, 157, 160, 141, 141}, 11, 196, 74, 50, 214};

//: encrypted
EndBlueData show_imageData = (EndBlueData){25, (Byte []){124, 119, 122, 107, 96, 105, 109, 124, 125, 239}, 9, 172, 220, 202, 235};

//: personCardId
EndBlueData main_verticalIdent = (EndBlueData){119, (Byte []){7, 18, 5, 4, 24, 25, 52, 22, 5, 19, 62, 19, 231}, 12, 215, 48, 66, 101};

//: data
EndBlueData noti_globalName = (EndBlueData){137, (Byte []){237, 232, 253, 232, 172}, 4, 195, 224, 15, 47};

//: type
EndBlueData show_closeIdent = (EndBlueData){224, (Byte []){148, 153, 144, 133, 44}, 4, 232, 207, 150, 139};

//: fileName
EndBlueData show_contentDataValueKey = (EndBlueData){208, (Byte []){182, 185, 188, 181, 158, 177, 189, 181, 112}, 8, 153, 201, 209, 108};

//: fired
EndBlueData user_layerMsg = (EndBlueData){151, (Byte []){241, 254, 229, 242, 243, 49}, 5, 170, 238, 47, 186};

//: title
EndBlueData mModelId = (EndBlueData){81, (Byte []){37, 56, 37, 61, 52, 39}, 5, 250, 48, 39, 151};

//: sendPacketId
EndBlueData user_modelSizeFormat = (EndBlueData){60, (Byte []){79, 89, 82, 88, 108, 93, 95, 87, 89, 72, 117, 88, 145}, 12, 203, 172, 225, 118};

//: sessionName
EndBlueData m_shouldKey = (EndBlueData){35, (Byte []){80, 70, 80, 80, 74, 76, 77, 109, 66, 78, 70, 218}, 11, 243, 75, 28, 100};

//: md5
EndBlueData mainRemoveSelectedIdent = (EndBlueData){114, (Byte []){31, 22, 71, 123}, 3, 237, 26, 116, 250};

// __DEBUG__
// __CLOSE_PRINT__
//
//  VoiceSend.m
//  NIM
//
//  Created by amao on 7/2/15.
//  Copyright (c) 2015 Netease. All rights reserved.
//

// __M_A_C_R_O__
//: #import "NTESCustomAttachmentDecoder.h"
#import "VoiceSend.h"
//: #import "NTESCustomAttachmentDefines.h"
#import "NTESCustomAttachmentDefines.h"
//: #import "NTESJanKenPonAttachment.h"
#import "StyleBubble.h"
//: #import "NTESSnapchatAttachment.h"
#import "DisableTo.h"
//: #import "NTESWhiteboardAttachment.h"
#import "TitleAttachment.h"
//: #import "NTESRedPacketAttachment.h"
#import "BarName.h"
//: #import "NTESRedPacketTipAttachment.h"
#import "PermitMenu.h"
//: #import "NTESMultiRetweetAttachment.h"
#import "NameSessionSuccess.h"
//: #import "NSDictionary+NTESJson.h"
#import "NSDictionary+Occurrent.h"
//: #import "NTESSessionUtil.h"
#import "LanguageUtil.h"
//: #import "NTESShareCardAttachment.h"
#import "LengthAttachment.h"

//: @implementation NTESCustomAttachmentDecoder
@implementation VoiceSend
//: - (id<NIMCustomAttachment>)decodeAttachment:(NSString *)content
- (id<NIMCustomAttachment>)decodeAttachment:(NSString *)content
{
    //: id<NIMCustomAttachment> attachment = nil;
    id<NIMCustomAttachment> attachment = nil;

    //: NSData *data = [content dataUsingEncoding:NSUTF8StringEncoding];
    NSData *data = [content dataUsingEncoding:NSUTF8StringEncoding];
    //: if (data) {
    if (data) {
        //: NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:data
        NSDictionary *dict = [NSJSONSerialization JSONObjectWithData:data
                                                             //: options:0
                                                             options:0
                                                               //: error:nil];
                                                               error:nil];
        //: if ([dict isKindOfClass:[NSDictionary class]])
        if ([dict isKindOfClass:[NSDictionary class]])
        {
            //: NSInteger type = [dict jsonInteger:@"type"];
            NSInteger type = [dict occurrent:StringFromEndBlueData(&show_closeIdent)];
            //: NSDictionary *data = [dict jsonDict:@"data"];
            NSDictionary *data = [dict share:StringFromEndBlueData(&noti_globalName)];
            //: switch (type) {
            switch (type) {
                //: case CustomMessageTypeJanKenPon:
                case CustomMessageTypeJanKenPon:
                {
                    //: attachment = [[NTESJanKenPonAttachment alloc] init];
                    attachment = [[StyleBubble alloc] init];
                    //: ((NTESJanKenPonAttachment *)attachment).value = [data jsonInteger:@"value"];
                    ((StyleBubble *)attachment).value = [data occurrent:StringFromEndBlueData(&userTingValue)];
                }
                    //: break;
                    break;
                //: case CustomMessageTypeSnapchat:
                case CustomMessageTypeSnapchat:
                {
                    //: attachment = [[NTESSnapchatAttachment alloc] init];
                    attachment = [[DisableTo alloc] init];
                    //: ((NTESSnapchatAttachment *)attachment).md5 = [data jsonString:@"md5"];
                    ((DisableTo *)attachment).md5 = [data translate:StringFromEndBlueData(&mainRemoveSelectedIdent)];
                    //: ((NTESSnapchatAttachment *)attachment).url = [data jsonString:@"url"];
                    ((DisableTo *)attachment).url = [data translate:StringFromEndBlueData(&k_enableBackMsg)];
                    //: ((NTESSnapchatAttachment *)attachment).isFired = [data jsonBool:@"fired"];
                    ((DisableTo *)attachment).isFired = [data center:StringFromEndBlueData(&user_layerMsg)];
                }
                    //: break;
                    break;
                //: case CustomMessageTypeWhiteboard:
                case CustomMessageTypeWhiteboard:
                {
                    //: attachment = [[NTESWhiteboardAttachment alloc] init];
                    attachment = [[TitleAttachment alloc] init];
                    //: ((NTESWhiteboardAttachment *)attachment).flag = [data jsonInteger:@"flag"];
                    ((TitleAttachment *)attachment).flag = [data occurrent:StringFromEndBlueData(&mRangeValueIdent)];
                }
                    //: break;
                    break;
                //: case CustomMessageTypeRedPacket:
                case CustomMessageTypeRedPacket:
                {
                    //: attachment = [[NTESRedPacketAttachment alloc] init];
                    attachment = [[BarName alloc] init];
                    //: ((NTESRedPacketAttachment *)attachment).title = [data jsonString:@"title"];
                    ((BarName *)attachment).title = [data translate:StringFromEndBlueData(&mModelId)];
                    //: ((NTESRedPacketAttachment *)attachment).content = [data jsonString:@"content"];
                    ((BarName *)attachment).content = [data translate:StringFromEndBlueData(&m_stateStr)];
                    //: ((NTESRedPacketAttachment *)attachment).redPacketId = [data jsonString:@"redPacketId"];
                    ((BarName *)attachment).redPacketId = [data translate:StringFromEndBlueData(&dreamSingleName)];
                    //: ((NTESRedPacketAttachment *)attachment).sendID = [data jsonString:@"redPacketSendID"];
                    ((BarName *)attachment).sendID = [data translate:StringFromEndBlueData(&dreamContainerFormat)];

                }
                    //: break;
                    break;
                //: case CustomMessageTypeRedPacketTip:
                case CustomMessageTypeRedPacketTip:
                {
                    //: attachment = [[NTESRedPacketTipAttachment alloc] init];
                    attachment = [[PermitMenu alloc] init];
                    //: ((NTESRedPacketTipAttachment *)attachment).sendPacketId = [data jsonString:@"sendPacketId"];
                    ((PermitMenu *)attachment).sendPacketId = [data translate:StringFromEndBlueData(&user_modelSizeFormat)];
                    //: ((NTESRedPacketTipAttachment *)attachment).packetId = [data jsonString:@"redPacketId"];
                    ((PermitMenu *)attachment).packetId = [data translate:StringFromEndBlueData(&dreamSingleName)];
                    //: ((NTESRedPacketTipAttachment *)attachment).isGetDone = [data jsonString:@"isGetDone"];
                    ((PermitMenu *)attachment).isGetDone = [data translate:StringFromEndBlueData(&userSingleContent)];
                    //: ((NTESRedPacketTipAttachment *)attachment).openPacketId = [data jsonString:@"openPacketId"];
                    ((PermitMenu *)attachment).openPacketId = [data translate:StringFromEndBlueData(&app_globalTitle)];
                }
                    //: break;
                    break;
                //: case CustomMessageTypeMultiRetweet:
                case CustomMessageTypeMultiRetweet:
                {
                    //: attachment = [[NTESMultiRetweetAttachment alloc] init];
                    attachment = [[NameSessionSuccess alloc] init];
                    //: ((NTESMultiRetweetAttachment *)attachment).url = [data jsonString:@"url"];
                    ((NameSessionSuccess *)attachment).url = [data translate:StringFromEndBlueData(&k_enableBackMsg)];
                    //: ((NTESMultiRetweetAttachment *)attachment).md5 = [data jsonString:@"md5"];
                    ((NameSessionSuccess *)attachment).md5 = [data translate:StringFromEndBlueData(&mainRemoveSelectedIdent)];
                    //: ((NTESMultiRetweetAttachment *)attachment).fileName = [data jsonString:@"fileName"];
                    ((NameSessionSuccess *)attachment).fileName = [data translate:StringFromEndBlueData(&show_contentDataValueKey)];
                    //: ((NTESMultiRetweetAttachment *)attachment).compressed = [data jsonBool:@"compressed"];
                    ((NameSessionSuccess *)attachment).compressed = [data center:StringFromEndBlueData(&userEnableCustomTableId)];
                    //: ((NTESMultiRetweetAttachment *)attachment).encrypted = [data jsonBool:@"encrypted"];
                    ((NameSessionSuccess *)attachment).encrypted = [data center:StringFromEndBlueData(&show_imageData)];
                    //: ((NTESMultiRetweetAttachment *)attachment).password = [data jsonString:@"password"];
                    ((NameSessionSuccess *)attachment).password = [data translate:StringFromEndBlueData(&kTeamValue)];
                    //: ((NTESMultiRetweetAttachment *)attachment).messageAbstract = [data jsonArray:@"messageAbstract"];
                    ((NameSessionSuccess *)attachment).messageAbstract = [data user:StringFromEndBlueData(&mainMessageRemoteTextData)];
                    //: ((NTESMultiRetweetAttachment *)attachment).sessionName = [data jsonString:@"sessionName"];
                    ((NameSessionSuccess *)attachment).sessionName = [data translate:StringFromEndBlueData(&m_shouldKey)];
                    //: ((NTESMultiRetweetAttachment *)attachment).sessionId = [data jsonString:@"sessionId"];
                    ((NameSessionSuccess *)attachment).sessionId = [data translate:StringFromEndBlueData(&showSingleId)];
                }
                    //: break;
                    break;

                //: case CustomMessageTypeCard:
                case CustomMessageTypeCard:
                {
                    //: attachment = [[NTESShareCardAttachment alloc] init];
                    attachment = [[LengthAttachment alloc] init];
                    //: ((NTESShareCardAttachment *)attachment).title = [data jsonString:@"title"];
                    ((LengthAttachment *)attachment).title = [data translate:StringFromEndBlueData(&mModelId)];
                    //: ((NTESShareCardAttachment *)attachment).type = [data jsonString:@"type"];
                    ((LengthAttachment *)attachment).type = [data translate:StringFromEndBlueData(&show_closeIdent)];
                    //: ((NTESShareCardAttachment *)attachment).content = [data jsonString:@"content"];
                    ((LengthAttachment *)attachment).content = [data translate:StringFromEndBlueData(&m_stateStr)];
                    //: ((NTESShareCardAttachment *)attachment).personCardId = [data jsonString:@"personCardId"];
                    ((LengthAttachment *)attachment).personCardId = [data translate:StringFromEndBlueData(&main_verticalIdent)];
                }
                    //: break;
                    break;
                //: default:
                default:
                    //: break;
                    break;
            }
            //: attachment = [self checkAttachment:attachment] ? attachment : nil;
            attachment = [self image:attachment] ? attachment : nil;
        }
    }
    //: return attachment;
    return attachment;
}


//: - (BOOL)checkAttachment:(id<NIMCustomAttachment>)attachment{
- (BOOL)image:(id<NIMCustomAttachment>)attachment{
    //: BOOL check = NO;
    BOOL check = NO;
    //: if ([attachment isKindOfClass:[NTESJanKenPonAttachment class]])
    if ([attachment isKindOfClass:[StyleBubble class]])
    {
        //: NSInteger value = [((NTESJanKenPonAttachment *)attachment) value];
        NSInteger value = [((StyleBubble *)attachment) value];
        //: check = (value>=CustomJanKenPonValueKen && value<=CustomJanKenPonValuePon) ? YES : NO;
        check = (value>=CustomJanKenPonValueKen && value<=CustomJanKenPonValuePon) ? YES : NO;
    }
    //: else if ([attachment isKindOfClass:[NTESSnapchatAttachment class]])
    else if ([attachment isKindOfClass:[DisableTo class]])
    {
        //: check = YES;
        check = YES;
    }
    //: else if ([attachment isKindOfClass:[NTESShareCardAttachment class]])
    else if ([attachment isKindOfClass:[LengthAttachment class]])
    {
        //: check = YES;
        check = YES;
    }
    //: else if ([attachment isKindOfClass:[NTESWhiteboardAttachment class]])
    else if ([attachment isKindOfClass:[TitleAttachment class]])
    {
        //: NSInteger flag = [((NTESWhiteboardAttachment *)attachment) flag];
        NSInteger flag = [((TitleAttachment *)attachment) flag];
        //: check = ((flag >= CustomWhiteboardFlagInvite) && (flag <= CustomWhiteboardFlagClose)) ? YES : NO;
        check = ((flag >= CustomWhiteboardFlagInvite) && (flag <= CustomWhiteboardFlagClose)) ? YES : NO;
    }
    //: else if([attachment isKindOfClass:[NTESRedPacketAttachment class]] || [attachment isKindOfClass:[NTESRedPacketTipAttachment class]])
    else if([attachment isKindOfClass:[BarName class]] || [attachment isKindOfClass:[PermitMenu class]])
    {
        //: check = YES;
        check = YES;
    }
    //: else if ([attachment isKindOfClass:[NTESMultiRetweetAttachment class]])
    else if ([attachment isKindOfClass:[NameSessionSuccess class]])
    {
        //: NTESMultiRetweetAttachment *target = (NTESMultiRetweetAttachment *)attachment;
        NameSessionSuccess *target = (NameSessionSuccess *)attachment;
        //: if (target.messageAbstract.count == 0) {
        if (target.messageAbstract.count == 0) {
            //: check = NO;
            check = NO;
        //: } else if (target.encrypted && target.password.length == 0) {
        } else if (target.encrypted && target.password.length == 0) {
            //: check = NO;
            check = NO;
        //: } else {
        } else {
            //: check = YES;
            check = YES;
        }
    }
    //: return check;
    return check;
}
//: @end
@end

Byte *EndBlueDataToByte(EndBlueData *data) {
    if (data->remoteTing < 129) return data->imageBubble;
    for (int i = 0; i < data->beginLab; i++) {
        data->imageBubble[i] ^= data->looking;
    }
    data->imageBubble[data->beginLab] = 0;
    data->remoteTing = 2;
	if (data->beginLab >= 3) {
		data->eigenvalueOfAMatrix = data->imageBubble[0];
		data->endBar = data->imageBubble[1];
		data->visualImage = data->imageBubble[2];
	}
    return data->imageBubble;
}

NSString *StringFromEndBlueData(EndBlueData *data) {
    return [NSString stringWithUTF8String:(char *)EndBlueDataToByte(data)];
}
